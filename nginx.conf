worker_processes  1;
events {
	worker_connections  128;
}

http {
	upstream kestrel {
	server cierge:5000;
	}

	server {
		listen *:80;
		add_header Strict-Transport-Security max-age=15768000;
		return 301 https://$host$request_uri;
	}

	server {
		listen *:443 ssl;
		ssl_certificate /run/secrets/cierge_fullchain.pem;
		ssl_certificate_key /run/secrets/cierge_privkey.pem;	
		ssl_protocols TLSv1.1 TLSv1.2;
		ssl_prefer_server_ciphers on;
		ssl_ciphers "EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH";
		ssl_ecdh_curve secp384r1;
		ssl_session_cache shared:SSL:10m;
		ssl_session_tickets off;
		add_header Strict-Transport-Security "max-age=63072000; includeSubdomains; preload";
		add_header X-Frame-Options DENY;
		add_header X-Content-Type-Options nosniff;
		location / {
			proxy_pass      http://kestrel;
		}
	}
}